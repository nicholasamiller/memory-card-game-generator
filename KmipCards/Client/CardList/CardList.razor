@using KmipCards.Shared;
@using KmipCards.Client.Interfaces;
@inject ICardRepository CardRepository;

<style>
    .selected {
        background-color: #1E88E5 !important;
    }

        .selected > td {
            color: white !important;
        }

            .selected > td .mud-input {
                color: white !important;
            }
</style>




<MudTable Breakpoint="Breakpoint.Xxl" @ref="mudTable" RowClassFunc="@SelectedRowClassFunc" OnRowClick="RowClickEvent"  Items=@(_cards)
  T="CardRecord">
	<HeaderContent>
		<MudTh>Characters</MudTh>
		<MudTh>Pinyin</MudTh>
		<MudTh>English</MudTh>
	</HeaderContent>
	<RowTemplate>
		<MudTd DataLabel="Chinese">@context.CardDataDto.Chinese</MudTd>
		<MudTd DataLabel="Pinyin">@context.CardDataDto.Pinyin</MudTd>
		<MudTd DataLabel="English">@context.CardDataDto.English</MudTd>
	</RowTemplate>	
</MudTable>
 

@code {
	private MudTable<CardRecord> mudTable;
	private CardRecord _currentlySelectedRecord;
	private int selectedRowNumber = -1;
	private IEnumerable<CardRecord> _cards;


	protected override async Task OnInitializedAsync()
	{
		CardRepository.RepositoryChanged += (sender, args) =>
		{
			StateHasChanged();

		};
		_cards = await CardRepository.GetAllCards();

		await base.OnInitializedAsync();
	}


	
	private void RowClickEvent(TableRowClickEventArgs<CardRecord> tableRowClickEventArgs)
    {
    }

	private string SelectedRowClassFunc(CardRecord record, int rowNumber)
	{

		// deselect
		if (selectedRowNumber == rowNumber)
		{
			selectedRowNumber = -1;
			return string.Empty;
		}
		else if (mudTable.SelectedItem != null && mudTable.SelectedItem.Equals(record))
		{
			selectedRowNumber = rowNumber;
			_currentlySelectedRecord = record;
			return "selected";
        }
        else
        {
            return string.Empty;
        }
	}


}
